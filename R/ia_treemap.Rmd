---
title: "ia_treemap"
output: html_document
---

```{r}

library(dplyr)
library(ggplot2)
library(cori.charts)
library(cartogram)
library(sysfonts)
library(showtext)
library(treemapify)

sysfonts::font_add_google("Lato")
font_add(
  "TT Hoves",
  regular = "TypeType - TT Hoves Regular.ttf",
  bold = "TypeType - TT Hoves Bold.ttf",
  italic = "TypeType - TT Hoves Italic.ttf",
  bolditalic = "TypeType - TT Hoves Bold Italic.ttf"
)
showtext_auto()
showtext_opts(dpi = 300)

here::i_am("R/ia_treemap.Rmd")

source(here::here("R/utils.R"))
source(here::here("R/get_scenario_a_data.R"))
source(here::here("R/get_scenario_b_data.R"))
source(here::here("R/get_scenario_c_data.R"))

```


```{r}

dta <- readr::read_csv(here::here("data/ia_crop_calculations.csv"))
dta_a <- get_scenario_a_data() %>% aggregate_county_crop_totals_to_state()
dta_b <- get_scenario_b_data() %>% aggregate_county_crop_totals_to_state()
dta_c <- get_scenario_c_data() %>% aggregate_county_crop_totals_to_state()

dta_ia <- aggregate_county_crop_totals_to_state(dta)

```


```{r}

fill_scale <- c(
  "Corn, grain" = "#7B3F00",
  "Soybeans" = "#B87333",
  "Oats" = "#96D2AA",
  "Rye" = "#6B9C85",
  "Cover crops" = "#00835D",
  "Other harvested cropland" = "dimgray"
)

```


```{r}

# Current
fig <- get_treemap(
    dta_ia,
    "value",
    "name",
    "label",
    fill_scale
  ) +
  labs(
    title = "Current Iowa crop coverage",
    subtitle = "Squares sized according to harvested or planted acres",
    x = NULL,
    y = NULL,
    caption = "Source: 2017 Census of Agriculture"
  )

save_plot(fig, here::here("export/ia_curr_crop_treemap.png"))

```


```{r}

# Scenario A
fig <- get_treemap(
    dta_a,
    "value",
    "name",
    "label",
    fill_scale
  ) +
  labs(
    title = "Scenario A: Iowa crop coverage",
    subtitle = "Squares sized according to harvested or planted acres",
    x = NULL,
    y = NULL,
    caption = "Source: 2017 Census of Agriculture"
  )

save_plot(fig, here::here("export/ia_scenario_a_crop_treemap.png"))

```


```{r}

# Scenario B
fig <- get_treemap(
    dta_b,
    "value",
    "name",
    "label",
    fill_scale
  ) +
  labs(
    title = "Scenario B: Iowa crop coverage",
    subtitle = "Squares sized according to harvested or planted acres",
    x = NULL,
    y = NULL,
    caption = "Source: 2017 Census of Agriculture"
  )

save_plot(fig, here::here("export/ia_scenario_b_crop_treemap.png"))

```


```{r}

# Scenario C
fig <- get_treemap(
    dta_c,
    "value",
    "name",
    "label",
    fill_scale
  ) +
  labs(
    title = "Scenario C: Iowa crop coverage",
    subtitle = "Squares sized according to harvested or planted acres",
    x = NULL,
    y = NULL,
    caption = "Source: 2017 Census of Agriculture"
  )

save_plot(fig, here::here("export/ia_scenario_c_crop_treemap.png"))

```
